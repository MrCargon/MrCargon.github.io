<!-- 
PROJECTS PAGE
-->
<section class="main-section projects-section" id="projects" role="main" aria-labelledby="projects-title">
    <div class="projects-panel">
        <!-- Enhanced Panel Header -->
        <header class="panel-header">
            <h2 id="projects-title">My Projects</h2>
            <div class="header-controls">
                <span class="project-count" id="project-count" aria-live="polite">5 Projects</span>
            </div>
        </header>

        <!-- Projects Content Area -->
        <div class="projects-content">
            <!-- Enhanced Side Navigation -->
            <nav class="side-nav" aria-label="Project navigation" role="navigation">
                <div class="nav-content">
                    <h3>Browse Projects</h3>
                    <ul class="nav-list" role="list">
                        <li>
                            <a href="#barista-game" 
                               class="nav-button" 
                               aria-current="false"
                               data-category="interactive"
                               role="listitem">
                                <span class="project-title">Starbucks Barista Game</span>
                                <span class="project-category">Interactive Game</span>
                                <span class="project-status">üéÆ Live Demo</span>
                            </a>
                        </li>
                        <li>
                            <a href="#portfolio-site" 
                               class="nav-button" 
                               aria-current="false"
                               data-category="web"
                               role="listitem">
                                <span class="project-title">Portfolio Website</span>
                                <span class="project-category">Web Development</span>
                                <span class="project-status">üåê Live Site</span>
                            </a>
                        </li>
                        <li>
                            <a href="#solar-system" 
                               class="nav-button" 
                               aria-current="false"
                               data-category="3d"
                               role="listitem">
                                <span class="project-title">Solar System Simulation</span>
                                <span class="project-category">3D Modeling</span>
                                <span class="project-status">ü™ê Interactive</span>
                            </a>
                        </li>
                        <li>
                            <a href="#space-explorer" 
                               class="nav-button" 
                               aria-current="false"
                               data-category="game"
                               role="listitem">
                                <span class="project-title">Space Explorer</span>
                                <span class="project-category">Game Development</span>
                                <span class="project-status">üöÄ In Progress</span>
                            </a>
                        </li>
                        <li>
                            <a href="#data-viz" 
                               class="nav-button" 
                               aria-current="false"
                               data-category="web"
                               role="listitem">
                                <span class="project-title">Data Visualization</span>
                                <span class="project-category">Web Development</span>
                                <span class="project-status">üìä Complete</span>
                            </a>
                        </li>
                        <li>
                            <a href="#mobile-app" 
                               class="nav-button" 
                               aria-current="false"
                               data-category="mobile"
                               role="listitem">
                                <span class="project-title">Mobile Productivity App</span>
                                <span class="project-category">Mobile Development</span>
                                <span class="project-status">üì± Beta</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Content Header with Filters -->
                <div class="content-header">
                    <h3 class="content-title">Featured Projects</h3>
                    <p class="content-description">
                        Explore my diverse portfolio of interactive applications, games, and web experiences. 
                        Each project showcases different skills and technologies.
                    </p>
                </div>

                <!-- Enhanced Filters and Search -->
                <div class="projects-filters" role="toolbar" aria-label="Project filters">
                    <div class="filter-group" role="group" aria-label="Category filters">
                        <button class="filter-btn active" data-category="all" aria-pressed="true">
                            All Projects
                        </button>
                        <button class="filter-btn" data-category="interactive" aria-pressed="false">
                            Interactive
                        </button>
                        <button class="filter-btn" data-category="web" aria-pressed="false">
                            Web Dev
                        </button>
                        <button class="filter-btn" data-category="3d" aria-pressed="false">
                            3D/Graphics
                        </button>
                        <button class="filter-btn" data-category="game" aria-pressed="false">
                            Games
                        </button>
                        <button class="filter-btn" data-category="mobile" aria-pressed="false">
                            Mobile
                        </button>
                    </div>
                    <div class="search-group">
                        <input type="search" 
                               class="search-box" 
                               placeholder="Search projects..." 
                               aria-label="Search projects"
                               id="project-search">
                    </div>
                </div>

                <!-- Enhanced Project Grid -->
                <div class="project-grid-container">
                    <div class="project-grid" role="grid" aria-label="Projects grid">
                        
                        <!-- Interactive Game Project - Barista Game -->
                        <article class="project-card interactive-game" 
                                id="barista-game" 
                                tabindex="0" 
                                role="gridcell"
                                data-category="interactive"
                                data-featured="true"
                                aria-labelledby="barista-title">
                            <div class="project-image">
                                <img src="https://images.unsplash.com/photo-1559056199-641a0ac8b55e?w=400&h=200&fit=crop&crop=center" 
                                    alt="Starbucks Barista Game - Interactive coffee making simulator" 
                                    loading="lazy">
                            </div>
                            <div class="project-info">
                                <div class="project-meta">
                                    <span class="project-type">Interactive Game</span>
                                    <span class="project-date">2025</span>
                                </div>
                                <h3 id="barista-title">Starbucks Barista Adventure</h3>
                                <p>
                                    An engaging educational game where you learn to make authentic Starbucks drinks through 
                                    interactive challenges. Master recipes, earn badges, and become the ultimate barista!
                                </p>
                                <div class="project-tags">
                                    <span class="tag">React</span>
                                    <span class="tag">Interactive</span>
                                    <span class="tag">Educational</span>
                                    <span class="tag">Game Design</span>
                                    <span class="tag">UI/UX</span>
                                </div>
                                <div class="project-actions">
                                    <button class="project-btn primary" 
                                            data-game="barista"
                                            aria-describedby="barista-title">
                                        <span>üéÆ</span> Play Game
                                    </button>
                                    <a href="#" class="project-btn" aria-label="View Barista Game source code">
                                        <span>üîó</span> Code
                                    </a>
                                </div>
                            </div>
                        </article>

                        <!-- Portfolio Website Project -->
                        <article class="project-card" 
                                id="portfolio-site" 
                                tabindex="0" 
                                role="gridcell"
                                data-category="web"
                                data-featured="true"
                                aria-labelledby="portfolio-title">
                            <div class="project-image">
                                <img src="https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=400&h=200&fit=crop&crop=center" 
                                    alt="Modern portfolio website with space theme" 
                                    loading="lazy">
                            </div>
                            <div class="project-info">
                                <div class="project-meta">
                                    <span class="project-type">Web Development</span>
                                    <span class="project-date">2025</span>
                                </div>
                                <h3 id="portfolio-title">Interactive Portfolio</h3>
                                <p>
                                    A modern, responsive portfolio website featuring an interactive 3D solar system, 
                                    smooth animations, and optimized performance. Built with vanilla JavaScript and Three.js.
                                </p>
                                <div class="project-tags">
                                    <span class="tag">JavaScript</span>
                                    <span class="tag">Three.js</span>
                                    <span class="tag">CSS3</span>
                                    <span class="tag">Responsive</span>
                                    <span class="tag">Performance</span>
                                </div>
                                <div class="project-actions">
                                    <a href="#" class="project-btn primary" aria-describedby="portfolio-title">
                                        <span>üåê</span> Live Site
                                    </a>
                                    <a href="#" class="project-btn" aria-label="View portfolio source code">
                                        <span>üîó</span> Code
                                    </a>
                                </div>
                            </div>
                        </article>

                        <!-- Solar System Project -->
                        <article class="project-card" 
                                id="solar-system" 
                                tabindex="0" 
                                role="gridcell"
                                data-category="3d"
                                data-featured="true"
                                aria-labelledby="solar-title">
                            <div class="project-image">
                                <img src="src/assets/textures/sun/sun_map.jpg" 
                                    alt="3D Solar System simulation with realistic planet textures" 
                                    loading="lazy"
                                    onerror="this.src='https://images.unsplash.com/photo-1446776877081-d282a0f896e2?w=400&h=200&fit=crop&crop=center'">
                            </div>
                            <div class="project-info">
                                <div class="project-meta">
                                    <span class="project-type">3D Simulation</span>
                                    <span class="project-date">2024</span>
                                </div>
                                <h3 id="solar-title">Solar System Simulator</h3>
                                <p>
                                    Immersive 3D solar system with accurate planetary orbits, realistic textures, 
                                    and interactive controls. Features dynamic lighting and camera controls.
                                </p>
                                <div class="project-tags">
                                    <span class="tag">Three.js</span>
                                    <span class="tag">WebGL</span>
                                    <span class="tag">3D Graphics</span>
                                    <span class="tag">Physics</span>
                                    <span class="tag">Astronomy</span>
                                </div>
                                <div class="project-actions">
                                    <a href="#main" class="project-btn primary" aria-describedby="solar-title">
                                        <span>ü™ê</span> Explore
                                    </a>
                                    <a href="#" class="project-btn" aria-label="View solar system source code">
                                        <span>üîó</span> Code
                                    </a>
                                </div>
                            </div>
                        </article>

                        <!-- Space Explorer Game -->
                        <article class="project-card" 
                                id="space-explorer" 
                                tabindex="0" 
                                role="gridcell"
                                data-category="game"
                                aria-labelledby="space-title">
                            <div class="project-image">
                                <img src="https://images.unsplash.com/photo-1502134249126-9f3755a50d78?w=400&h=200&fit=crop&crop=center" 
                                    alt="Space exploration game with spacecraft and planets" 
                                    loading="lazy">
                            </div>
                            <div class="project-info">
                                <div class="project-meta">
                                    <span class="project-type">Game Development</span>
                                    <span class="project-date">2024</span>
                                </div>
                                <h3 id="space-title">Space Explorer</h3>
                                <p>
                                    An adventure game where players navigate through space, discover planets, 
                                    and collect resources. Built with Godot engine and custom physics.
                                </p>
                                <div class="project-tags">
                                    <span class="tag">Godot</span>
                                    <span class="tag">GDScript</span>
                                    <span class="tag">Game Design</span>
                                    <span class="tag">Physics</span>
                                    <span class="tag">Procedural</span>
                                </div>
                                <div class="project-actions">
                                    <button class="project-btn primary" disabled aria-describedby="space-title">
                                        <span>üöß</span> In Development
                                    </button>
                                    <a href="#" class="project-btn" aria-label="View space explorer source code">
                                        <span>üîó</span> Code
                                    </a>
                                </div>
                            </div>
                        </article>

                        <!-- Data Visualization Project -->
                        <article class="project-card" 
                                id="data-viz" 
                                tabindex="0" 
                                role="gridcell"
                                data-category="web"
                                aria-labelledby="data-title">
                            <div class="project-image">
                                <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=200&fit=crop&crop=center" 
                                    alt="Interactive data visualization dashboard with charts and graphs" 
                                    loading="lazy">
                            </div>
                            <div class="project-info">
                                <div class="project-meta">
                                    <span class="project-type">Data Visualization</span>
                                    <span class="project-date">2024</span>
                                </div>
                                <h3 id="data-title">Interactive Dashboard</h3>
                                <p>
                                    Dynamic data visualization platform with real-time charts, filtering capabilities, 
                                    and responsive design. Processes large datasets efficiently.
                                </p>
                                <div class="project-tags">
                                    <span class="tag">D3.js</span>
                                    <span class="tag">Chart.js</span>
                                    <span class="tag">Data Analysis</span>
                                    <span class="tag">Real-time</span>
                                    <span class="tag">Responsive</span>
                                </div>
                                <div class="project-actions">
                                    <a href="#" class="project-btn primary" aria-describedby="data-title">
                                        <span>üìä</span> View Demo
                                    </a>
                                    <a href="#" class="project-btn" aria-label="View dashboard source code">
                                        <span>üîó</span> Code
                                    </a>
                                </div>
                            </div>
                        </article>
                    </div>

                    <!-- Loading State (hidden by default) -->
                    <div class="loading-state" style="display: none;" role="status" aria-live="polite">
                        <div class="loading-spinner" aria-hidden="true"></div>
                        <p>Loading projects...</p>
                    </div>

                    <!-- Empty State (hidden by default) -->
                    <div class="empty-state" style="display: none;" role="status">
                        <p>No projects found matching your criteria.</p>
                        <button class="project-btn" onclick="clearFilters()">Clear Filters</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Enhanced Game Container for Interactive Projects -->
    <div id="game-container" class="projects-panel" style="display: none;" role="region" aria-label="Interactive game">
        <header class="panel-header">
            <h2 id="game-title">Interactive Game</h2>
            <div class="header-controls">
                <button class="project-btn" onclick="window.pageManager?.closeGame()" aria-label="Close game">
                    <span>‚úï</span> Close
                </button>
            </div>
        </header>
        <div class="game-container" id="game-content">
            <!-- Game will be loaded here dynamically by PageManager -->
        </div>
    </div>
</section>

<!-- Enhanced JavaScript for Projects Page Integration -->
<script>
/**
 * Projects Page Enhanced Functionality
 * Streamlined and optimized integration with PageManager v2.2
 */

// Only initialize if not already handled by PageManager
document.addEventListener('DOMContentLoaded', function() {
    // Check if PageManager will handle initialization
    if (window.pageManager && window.pageManager.pages && window.pageManager.pages.projects) {
        console.log('üìÇ Projects page will be initialized by PageManager');
        return;
    }
    
    // Fallback initialization if PageManager is not available
    if (document.getElementById('projects')) {
        setTimeout(() => initializeProjectsPageFallback(), 100);
    }
});

/**
 * Fallback initialization when PageManager is not available
 */
function initializeProjectsPageFallback() {
    console.log('üìÇ Fallback: Initializing projects page directly');
    
    setupProjectNavigation();
    setupProjectFilters();
    setupProjectSearch();
    setupProjectInteractions();
    setupGameButtons();
    
    // Initialize with featured projects only
    showFeaturedProjectsOnly();
    updateProjectCount();
    
    console.log('‚úÖ Projects page fallback initialization complete');
}

/**
 * Show only featured projects by default
 */
function showFeaturedProjectsOnly() {
    const projectCards = document.querySelectorAll('.project-card');
    const featuredProjects = document.querySelectorAll('.project-card[data-featured="true"]');
    
    console.log(`üåü Filtering to show ${featuredProjects.length} featured projects out of ${projectCards.length} total`);
    
    // Hide all non-featured projects
    projectCards.forEach((card, index) => {
        const isFeatured = card.getAttribute('data-featured') === 'true';
        
        if (isFeatured) {
            card.style.display = 'block';
            card.style.animation = `fadeInUp 0.6s ease-out ${index * 0.2}s both`;
        } else {
            card.style.display = 'none';
        }
    });
    
    // Update filter button to show "Featured" as active
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-pressed', 'false');
    });
    
    // Add featured filter button if it doesn't exist
    addFeaturedFilterButton();
    
    // Activate featured filter
    const featuredButton = document.querySelector('.filter-btn[data-category="featured"]');
    if (featuredButton) {
        featuredButton.classList.add('active');
        featuredButton.setAttribute('aria-pressed', 'true');
    }
    
    // Update navigation to show only featured projects
    updateNavigationForFeatured();
}

/**
 * Add Featured filter button as the first option
 */
function addFeaturedFilterButton() {
    const filterGroup = document.querySelector('.filter-group');
    let featuredButton = document.querySelector('.filter-btn[data-category="featured"]');
    
    if (!featuredButton && filterGroup) {
        featuredButton = document.createElement('button');
        featuredButton.className = 'filter-btn';
        featuredButton.setAttribute('data-category', 'featured');
        featuredButton.setAttribute('aria-pressed', 'false');
        featuredButton.innerHTML = '‚≠ê Featured';
        
        // Insert as first button
        filterGroup.insertBefore(featuredButton, filterGroup.firstChild);
        
        // Add event listener
        featuredButton.addEventListener('click', function() {
            const category = this.getAttribute('data-category');
            
            // Update active filter
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
            });
            
            this.classList.add('active');
            this.setAttribute('aria-pressed', 'true');
            
            // Filter projects
            if (category === 'featured') {
                showFeaturedProjectsOnly();
            } else {
                filterProjects(category, document.querySelectorAll('.project-card'));
            }
            updateProjectCount();
        });
        
        console.log('‚≠ê Added Featured filter button');
    }
}

/**
 * Update navigation to highlight only featured projects
 */
function updateNavigationForFeatured() {
    const navButtons = document.querySelectorAll('.nav-button');
    const featuredProjects = ['barista-game', 'portfolio-site', 'solar-system'];
    
    navButtons.forEach(button => {
        const href = button.getAttribute('href');
        const projectId = href ? href.substring(1) : '';
        
        if (featuredProjects.includes(projectId)) {
            button.style.opacity = '1';
            button.style.transform = 'none';
            button.setAttribute('aria-hidden', 'false');
        } else {
            button.style.opacity = '0.4';
            button.style.transform = 'translateX(-10px)';
            button.setAttribute('aria-hidden', 'true');
        }
    });
}

/**
 * Setup game loading buttons with improved error handling
 */
function setupGameButtons() {
    const gameButtons = document.querySelectorAll('[data-game], .project-btn[onclick*="Game"]');
    
    gameButtons.forEach(button => {
        // Remove any existing onclick handlers
        button.removeAttribute('onclick');
        
        // Add enhanced click handler
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Prevent multiple clicks
            if (this.disabled) return;
            
            const gameType = this.getAttribute('data-game') || 'barista';
            
            // Try PageManager first, then fallback
            if (window.pageManager && typeof window.pageManager.loadGame === 'function') {
                window.pageManager.loadGame(gameType, this).catch(error => {
                    console.error('PageManager game loading failed:', error);
                    loadGameFallback(gameType, this);
                });
            } else {
                loadGameFallback(gameType, this);
            }
        });
    });
    
    console.log(`üéÆ Game loading setup for ${gameButtons.length} buttons`);
}

/**
 * Improved fallback game loading
 */
function loadGameFallback(gameType, button) {
    const originalHTML = button.innerHTML;
    button.innerHTML = '<span>‚è≥</span> Loading...';
    button.disabled = true;
    
    try {
        const gameContainer = document.getElementById('game-container');
        const gameContent = document.getElementById('game-content');
        
        if (!gameContainer || !gameContent) {
            throw new Error('Game container elements not found');
        }
        
        // Show container
        gameContainer.style.display = 'block';
        
        // Create loading content
        gameContent.innerHTML = createGameLoadingContent(gameType);
        
        // Scroll to game
        gameContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Simulate loading process
        setTimeout(() => {
            if (gameType === 'barista' && window.StarbucksGame) {
                try {
                    gameContent.innerHTML = '';
                    new StarbucksGame(gameContent);
                    button.innerHTML = '<span>üéÆ</span> Game Loaded';
                } catch (error) {
                    console.error('Game initialization failed:', error);
                    showGameError(gameContent, error);
                }
            } else {
                showGamePlaceholder(gameContent, gameType);
            }
            
            // Reset button after delay
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.disabled = false;
            }, 2000);
        }, 1500);
        
    } catch (error) {
        console.error('Game loading error:', error);
        button.innerHTML = '<span>‚ùå</span> Error';
        setTimeout(() => {
            button.innerHTML = originalHTML;
            button.disabled = false;
        }, 3000);
    }
}

/**
 * Create loading content for games
 */
function createGameLoadingContent(gameType) {
    const gameInfo = {
        barista: { name: 'Starbucks Barista Adventure', icon: '‚òï', color: '#10b981' },
        default: { name: 'Interactive Game', icon: 'üéÆ', color: '#3b82f6' }
    };
    
    const info = gameInfo[gameType] || gameInfo.default;
    
    return `
        <div class="game-loading-state" style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, ${info.color}, ${adjustColor(info.color, -20)}); color: white; text-align: center; padding: 2rem;">
            <div>
                <div style="font-size: 4rem; margin-bottom: 1rem; animation: bounce 2s infinite;">${info.icon}</div>
                <h3 style="font-size: 1.5rem; margin-bottom: 1rem; font-weight: 600;">Loading ${info.name}</h3>
                <p style="margin-bottom: 2rem; opacity: 0.9;">Preparing your interactive experience...</p>
                <div style="width: 200px; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; margin: 0 auto; overflow: hidden;">
                    <div style="width: 100%; height: 100%; background: white; transform: translateX(-100%); animation: loadProgress 1.5s ease-out forwards;"></div>
                </div>
            </div>
        </div>
        <style>
            @keyframes bounce {
                0%, 100% { transform: translateY(0); }
                50% { transform: translateY(-10px); }
            }
            @keyframes loadProgress {
                from { transform: translateX(-100%); }
                to { transform: translateX(0); }
            }
        </style>
    `;
}

/**
 * Show game error state
 */
function showGameError(container, error) {
    container.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #ef4444; color: white; text-align: center; padding: 2rem;">
            <div>
                <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">Game Loading Failed</h3>
                <p style="margin-bottom: 1rem; opacity: 0.9;">Unable to load the game</p>
                <p style="font-size: 0.875rem; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 4px; margin-bottom: 1.5rem;">${error.message}</p>
                <button onclick="closeGame()" style="padding: 0.75rem 1.5rem; background: white; color: #ef4444; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">Close</button>
            </div>
        </div>
    `;
}

/**
 * Show game placeholder
 */
function showGamePlaceholder(container, gameType) {
    container.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; text-align: center; padding: 2rem;">
            <div>
                <div style="font-size: 4rem; margin-bottom: 1rem;">üéÆ</div>
                <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">Game Preview</h3>
                <p style="margin-bottom: 2rem; opacity: 0.9;">This is a placeholder for the ${gameType} game</p>
                <button onclick="closeGame()" style="padding: 0.75rem 1.5rem; background: white; color: #6366f1; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">Close Preview</button>
            </div>
        </div>
    `;
}

/**
 * Close game function
 */
function closeGame() {
    if (window.pageManager && typeof window.pageManager.closeGame === 'function') {
        window.pageManager.closeGame();
    } else {
        // Fallback close
        const gameContainer = document.getElementById('game-container');
        if (gameContainer) {
            gameContainer.style.display = 'none';
            const gameContent = document.getElementById('game-content');
            if (gameContent) gameContent.innerHTML = '';
        }
        
        // Scroll back to projects
        const projectsSection = document.getElementById('projects');
        if (projectsSection) {
            projectsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
}

/**
 * Setup project navigation with improved UX
 */
function setupProjectNavigation() {
    const navButtons = document.querySelectorAll('.nav-button');
    
    navButtons.forEach((button, index) => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Update active state with smooth transition
            navButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-current', 'false');
            });
            
            this.classList.add('active');
            this.setAttribute('aria-current', 'true');
            
            // Scroll to target project with enhanced behavior
            const targetId = this.getAttribute('href');
            const targetProject = document.querySelector(targetId);
            
            if (targetProject) {
                // Smooth scroll with better positioning
                targetProject.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center',
                    inline: 'nearest'
                });
                
                // Enhanced highlight effect
                targetProject.classList.add('highlight');
                setTimeout(() => targetProject.classList.remove('highlight'), 2000);
                
                // Improved accessibility
                setTimeout(() => targetProject.focus(), 600);
            }
        });
        
        // Add keyboard navigation
        button.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowDown' && navButtons[index + 1]) {
                e.preventDefault();
                navButtons[index + 1].focus();
            } else if (e.key === 'ArrowUp' && navButtons[index - 1]) {
                e.preventDefault();
                navButtons[index - 1].focus();
            }
        });
    });
}

/**
 * Setup project filters with animations
 */
function setupProjectFilters() {
    const filterButtons = document.querySelectorAll('.filter-btn');
    const projectCards = document.querySelectorAll('.project-card');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            const category = this.getAttribute('data-category');
            
            // Update active filter with transition
            filterButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-pressed', 'false');
            });
            
            this.classList.add('active');
            this.setAttribute('aria-pressed', 'true');
            
            // Animate filter transition
            filterProjects(category, projectCards);
            updateProjectCount();
        });
    });
}

/**
 * Enhanced project filtering with animations
 */
function filterProjects(category, projectCards) {
    let visibleCount = 0;
    
    projectCards.forEach((card, index) => {
        const cardCategory = card.getAttribute('data-category');
        const isFeatured = card.getAttribute('data-featured') === 'true';
        
        let shouldShow = false;
        
        if (category === 'featured') {
            shouldShow = isFeatured;
        } else if (category === 'all') {
            shouldShow = true;
        } else {
            shouldShow = cardCategory === category;
        }
        
        if (shouldShow) {
            card.style.display = 'block';
            card.style.animation = `fadeInUp 0.6s ease-out ${index * 0.1}s both`;
            visibleCount++;
        } else {
            card.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => {
                if (card.style.animation.includes('fadeOut')) {
                    card.style.display = 'none';
                }
            }, 300);
        }
    });
    
    // Update navigation visibility based on filter
    if (category === 'featured') {
        updateNavigationForFeatured();
    } else {
        resetNavigationVisibility();
    }
    
    // Handle empty state
    const emptyState = document.querySelector('.empty-state');
    if (emptyState) {
        emptyState.style.display = visibleCount === 0 ? 'flex' : 'none';
    }
}

/**
 * Reset navigation visibility to show all projects
 */
function resetNavigationVisibility() {
    const navButtons = document.querySelectorAll('.nav-button');
    
    navButtons.forEach(button => {
        button.style.opacity = '1';
        button.style.transform = 'none';
        button.setAttribute('aria-hidden', 'false');
    });
}

/**
 * Setup enhanced search functionality
 */
function setupProjectSearch() {
    const searchBox = document.getElementById('project-search');
    if (!searchBox) return;
    
    let searchTimeout;
    
    searchBox.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        const searchTerm = this.value.toLowerCase().trim();
        
        // Debounce search for better performance
        searchTimeout = setTimeout(() => {
            performSearch(searchTerm);
        }, 300);
    });
    
    // Handle search on Enter key
    searchBox.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            clearTimeout(searchTimeout);
            performSearch(this.value.toLowerCase().trim());
        }
    });
}

/**
 * Perform search with highlighting
 */
function performSearch(searchTerm) {
    const projectCards = document.querySelectorAll('.project-card');
    let visibleCount = 0;
    
    projectCards.forEach(card => {
        const title = card.querySelector('h3').textContent.toLowerCase();
        const description = card.querySelector('p').textContent.toLowerCase();
        const tags = Array.from(card.querySelectorAll('.tag'))
            .map(tag => tag.textContent.toLowerCase())
            .join(' ');
        
        const shouldShow = !searchTerm || 
                          title.includes(searchTerm) || 
                          description.includes(searchTerm) || 
                          tags.includes(searchTerm);
        
        if (shouldShow) {
            card.style.display = 'block';
            card.style.animation = 'fadeInUp 0.4s ease-out';
            visibleCount++;
        } else {
            card.style.display = 'none';
        }
    });
    
    updateProjectCount();
    
    // Handle empty state
    const emptyState = document.querySelector('.empty-state');
    if (emptyState) {
        emptyState.style.display = visibleCount === 0 ? 'flex' : 'none';
    }
}

/**
 * Setup enhanced project card interactions
 */
function setupProjectInteractions() {
    const projectCards = document.querySelectorAll('.project-card');
    
    projectCards.forEach(card => {
        // Enhanced click feedback
        card.addEventListener('click', function(e) {
            if (e.target.closest('.project-btn') || e.target.closest('a')) return;
            
            this.style.transform = 'scale(0.98)';
            this.style.transition = 'transform 0.1s ease';
            
            setTimeout(() => {
                this.style.transform = '';
                this.style.transition = '';
            }, 150);
        });
        
        // Improved keyboard navigation
        card.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                const primaryBtn = this.querySelector('.project-btn.primary');
                if (primaryBtn) primaryBtn.click();
            }
        });
        
        // Add hover effects for better UX
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-4px) scale(1.01)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = '';
        });
    });
}

/**
 * Enhanced project count update
 */
function updateProjectCount() {
    const projectCount = document.getElementById('project-count');
    if (!projectCount) return;
    
    const visibleProjects = document.querySelectorAll('.project-card:not([style*="display: none"])').length;
    const totalProjects = document.querySelectorAll('.project-card').length;
    
    const countText = visibleProjects === totalProjects 
        ? `${totalProjects} Projects` 
        : `${visibleProjects} of ${totalProjects} Projects`;
    
    // Animate count change
    projectCount.style.transition = 'opacity 0.2s ease';
    projectCount.style.opacity = '0.5';
    
    setTimeout(() => {
        projectCount.textContent = countText;
        projectCount.style.opacity = '1';
    }, 100);
}

/**
 * Clear all filters with animation
 */
function clearFilters() {
    // Reset filter buttons
    const filterButtons = document.querySelectorAll('.filter-btn');
    filterButtons.forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-pressed', 'false');
    });
    
    // Activate "All Projects" filter
    const allButton = document.querySelector('.filter-btn[data-category="all"]');
    if (allButton) {
        allButton.classList.add('active');
        allButton.setAttribute('aria-pressed', 'true');
    }
    
    // Clear search
    const searchBox = document.getElementById('project-search');
    if (searchBox) searchBox.value = '';
    
    // Show all projects with staggered animation
    const projectCards = document.querySelectorAll('.project-card');
    projectCards.forEach((card, index) => {
        card.style.display = 'block';
        card.style.animation = `fadeInUp 0.4s ease-out ${index * 0.05}s both`;
    });
    
    // Hide empty state
    const emptyState = document.querySelector('.empty-state');
    if (emptyState) emptyState.style.display = 'none';
    
    updateProjectCount();
}

/**
 * Utility functions
 */
function adjustColor(color, amount) {
    return color.replace(/^#/, '').replace(/../g, color => ('0' + Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).substr(-2));
}

// Export enhanced utilities for PageManager integration
if (typeof window !== 'undefined') {
    window.projectsPageUtils = {
        initializeProjectsPage: initializeProjectsPageFallback,
        setupGameButtons,
        filterProjects,
        updateProjectCount,
        clearFilters,
        performSearch
    };
}

// Add enhanced CSS animations
const enhancedCSS = document.createElement('style');
enhancedCSS.textContent = `
    .project-card.highlight {
        animation: highlightPulse 1.5s ease-out;
        border-color: var(--primary-color, #ffa500) !important;
        box-shadow: 0 0 25px rgba(255, 165, 0, 0.6) !important;
    }
    
    @keyframes highlightPulse {
        0% { transform: scale(1); }
        25% { transform: scale(1.02); }
        50% { transform: scale(1.05); }
        75% { transform: scale(1.02); }
        100% { transform: scale(1); }
    }
    
    @keyframes fadeOut {
        from { opacity: 1; transform: translateY(0); }
        to { opacity: 0; transform: translateY(-20px); }
    }
    
    /* Enhanced loading animations */
    .project-card {
        animation: fadeInUp 0.6s ease-out both;
    }
    
    /* Improved scrollbar for better UX */
    .project-grid-container {
        scroll-behavior: smooth;
    }
    
    /* Enhanced focus styles */
    .project-card:focus-visible {
        outline: 3px solid var(--primary-color);
        outline-offset: 3px;
        box-shadow: 0 0 0 6px rgba(255, 165, 0, 0.2);
    }
    
    /* Better hover transitions */
    .project-btn {
        position: relative;
        overflow: hidden;
    }
    
    .project-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s ease;
    }
    
    .project-btn:hover::before {
        left: 100%;
    }
`;
document.head.appendChild(enhancedCSS);

console.log('üìÇ Enhanced projects page integration loaded');
</script>
